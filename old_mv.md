| schemaname | matviewname                | definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ---------- | -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| public     | mv_essendon_player_careers |  WITH debut_info AS (
         SELECT afl_data.player_id,
            min(afl_data.match_date) AS debut_date
           FROM afl_data
          WHERE afl_data.player_team = 'Essendon'::text
          GROUP BY afl_data.player_id
        ), debut_details AS (
         SELECT a_1.player_id,
                CASE
                    WHEN a_1.match_round ~ '^\d+$'::text THEN a_1.match_round::integer
                    ELSE NULL::integer
                END AS debut_round,
            a_1.match_date AS debut_date
           FROM afl_data a_1
             JOIN debut_info d_1 ON a_1.player_id = d_1.player_id AND a_1.match_date = d_1.debut_date
          WHERE a_1.player_team = 'Essendon'::text
        )
 SELECT a.player_id,
    a.player_first_name,
    a.player_last_name,
    a.player_team,
    EXTRACT(year FROM dd.debut_date) AS debut_year,
    dd.debut_round,
    dd.debut_date,
    count(DISTINCT a.match_id) AS games_played,
    sum(a.goals) AS career_goals,
    sum(a.behinds) AS career_behinds,
    sum(a.disposals) AS career_disposals,
    sum(a.kicks) AS career_kicks,
    sum(a.handballs) AS career_handballs,
    sum(a.marks) AS career_marks,
    sum(a.tackles) AS career_tackles,
    sum(a.hitouts) AS career_hitouts
   FROM afl_data a
     JOIN debut_info d ON a.player_id = d.player_id
     LEFT JOIN debut_details dd ON a.player_id = dd.player_id
  WHERE a.player_team = 'Essendon'::text
  GROUP BY a.player_id, a.player_first_name, a.player_last_name, a.player_team, dd.debut_round, dd.debut_date;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| public     | mv_player_totals           |  WITH player_totals AS (
         SELECT EXTRACT(year FROM afl_data.match_date)::integer AS season,
            afl_data.player_id,
            afl_data.player_first_name,
            afl_data.player_last_name,
            afl_data.player_team,
            sum(
                CASE
                    WHEN afl_data.kicks::text ~ '^\d+$'::text THEN afl_data.kicks
                    ELSE 0
                END) AS total_kicks,
            sum(
                CASE
                    WHEN afl_data.handballs::text ~ '^\d+$'::text THEN afl_data.handballs
                    ELSE 0
                END) AS total_handballs,
            sum(
                CASE
                    WHEN afl_data.marks::text ~ '^\d+$'::text THEN afl_data.marks
                    ELSE 0
                END) AS total_marks,
            sum(
                CASE
                    WHEN afl_data.tackles::text ~ '^\d+$'::text THEN afl_data.tackles
                    ELSE 0
                END) AS total_tackles,
            sum(
                CASE
                    WHEN afl_data.disposals::text ~ '^\d+$'::text THEN afl_data.disposals
                    ELSE 0
                END) AS total_disposals,
            sum(
                CASE
                    WHEN afl_data.goals::text ~ '^\d+$'::text THEN afl_data.goals
                    ELSE 0
                END) AS total_goals
           FROM afl_data
          GROUP BY (EXTRACT(year FROM afl_data.match_date)::integer), afl_data.player_id, afl_data.player_first_name, afl_data.player_last_name, afl_data.player_team
        ), ranked AS (
         SELECT pt.season,
            pt.player_id,
            pt.player_first_name,
            pt.player_last_name,
            pt.player_team,
            pt.total_kicks,
            pt.total_handballs,
            pt.total_marks,
            pt.total_tackles,
            pt.total_disposals,
            pt.total_goals,
                CASE
                    WHEN pt.total_disposals > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_disposals DESC)
                    ELSE NULL::bigint
                END AS disp_rank,
                CASE
                    WHEN pt.total_goals > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_goals DESC)
                    ELSE NULL::bigint
                END AS goal_rank,
                CASE
                    WHEN pt.total_kicks > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_kicks DESC)
                    ELSE NULL::bigint
                END AS kick_rank,
                CASE
                    WHEN pt.total_handballs > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_handballs DESC)
                    ELSE NULL::bigint
                END AS handball_rank,
                CASE
                    WHEN pt.total_marks > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_marks DESC)
                    ELSE NULL::bigint
                END AS mark_rank,
                CASE
                    WHEN pt.total_tackles > 0 THEN rank() OVER (PARTITION BY pt.season ORDER BY pt.total_tackles DESC)
                    ELSE NULL::bigint
                END AS tackle_rank
           FROM player_totals pt
        )
 SELECT season,
    player_id,
    player_first_name,
    player_last_name,
    player_team,
    total_disposals,
    total_goals,
    total_kicks,
    total_handballs,
    total_marks,
    total_tackles,
    disp_rank,
    goal_rank,
    kick_rank,
    handball_rank,
    mark_rank,
    tackle_rank
   FROM ranked
  WHERE 1 = ANY (ARRAY[disp_rank, goal_rank, kick_rank, handball_rank, mark_rank, tackle_rank])
  ORDER BY season DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public     | mv_season_ladders          |  WITH regular_season_matches AS (
         SELECT v_matches.match_id,
            v_matches.match_date,
            v_matches.match_round,
            v_matches.venue_name,
            v_matches.match_home_team,
            v_matches.match_away_team,
            v_matches.match_home_team_score,
            v_matches.match_away_team_score,
            v_matches.match_margin,
            v_matches.match_winner
           FROM v_matches
          WHERE v_matches.match_round ~ '^\d+$'::text
        ), team_results AS (
         SELECT EXTRACT(year FROM regular_season_matches.match_date)::integer AS season,
            unnest(ARRAY[regular_season_matches.match_home_team, regular_season_matches.match_away_team]) AS team,
            unnest(ARRAY[
                CASE
                    WHEN regular_season_matches.match_home_team = regular_season_matches.match_winner THEN 1::numeric
                    WHEN regular_season_matches.match_winner = 'Draw'::text THEN 0.5
                    ELSE 0::numeric
                END,
                CASE
                    WHEN regular_season_matches.match_away_team = regular_season_matches.match_winner THEN 1::numeric
                    WHEN regular_season_matches.match_winner = 'Draw'::text THEN 0.5
                    ELSE 0::numeric
                END]) AS result,
            unnest(ARRAY[regular_season_matches.match_home_team_score, regular_season_matches.match_away_team_score]) AS points_for,
            unnest(ARRAY[regular_season_matches.match_away_team_score, regular_season_matches.match_home_team_score]) AS points_against
           FROM regular_season_matches
        ), grouped AS (
         SELECT team_results.season,
            team_results.team,
            count(*) AS games_played,
            sum(
                CASE
                    WHEN team_results.result = 1::numeric THEN 1
                    ELSE 0
                END) AS wins,
            sum(
                CASE
                    WHEN team_results.result = 0.5 THEN 1
                    ELSE 0
                END) AS draws,
            sum(
                CASE
                    WHEN team_results.result = 0::numeric THEN 1
                    ELSE 0
                END) AS losses,
            sum(team_results.points_for) AS points_for,
            sum(team_results.points_against) AS points_against,
            round(sum(team_results.points_for)::numeric / GREATEST(sum(team_results.points_against), 1::bigint)::numeric * 100::numeric, 1) AS percentage
           FROM team_results
          GROUP BY team_results.season, team_results.team
        ), final AS (
         SELECT grouped.season,
            grouped.team,
            grouped.games_played,
            grouped.wins,
            grouped.draws,
            grouped.losses,
            grouped.points_for,
            grouped.points_against,
            grouped.percentage,
            rank() OVER (PARTITION BY grouped.season ORDER BY (grouped.wins * 4 + grouped.draws * 2) DESC, grouped.percentage DESC) AS ladder_pos
           FROM grouped
        )
 SELECT season,
    team,
    games_played,
    wins,
    draws,
    losses,
    points_for,
    points_against,
    percentage,
    ladder_pos
   FROM final;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| public     | mv_season_summary          |  WITH games AS (
         SELECT EXTRACT(year FROM v_matches.match_date)::integer AS season,
            v_matches.match_round,
            v_matches.match_winner,
            v_matches.match_home_team_score + v_matches.match_away_team_score AS total_score,
            GREATEST(v_matches.match_home_team_score, v_matches.match_away_team_score) AS highest_team_score,
            v_matches.match_margin
           FROM v_matches
        ), base AS (
         SELECT games.season,
            count(*) AS total_matches,
            round(avg(games.total_score), 1) AS avg_game_score,
            max(games.highest_team_score) AS highest_score,
            max(games.match_margin) AS biggest_margin,
            max(games.match_winner) FILTER (WHERE games.match_round = 'GF'::text) AS premiers
           FROM games
          GROUP BY games.season
        ), top_disposals AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_disposals_player,
            mv.total_disposals AS top_disposals_total,
            mv.player_team AS top_disposals_team
           FROM mv_player_totals mv
          WHERE mv.disp_rank = 1
          ORDER BY mv.season, mv.player_id
        ), top_goals AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_goals_player,
            mv.total_goals AS top_goals_total,
            mv.player_team AS top_goals_team
           FROM mv_player_totals mv
          WHERE mv.goal_rank = 1
          ORDER BY mv.season, mv.player_id
        ), top_kicks AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_kicks_player,
            mv.total_kicks AS top_kicks_total,
            mv.player_team AS top_kicks_team
           FROM mv_player_totals mv
          WHERE mv.kick_rank = 1
          ORDER BY mv.season, mv.player_id
        ), top_handballs AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_handballs_player,
            mv.total_handballs AS top_handballs_total,
            mv.player_team AS top_handballs_team
           FROM mv_player_totals mv
          WHERE mv.handball_rank = 1
          ORDER BY mv.season, mv.player_id
        ), top_marks AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_marks_player,
            mv.total_marks AS top_marks_total,
            mv.player_team AS top_marks_team
           FROM mv_player_totals mv
          WHERE mv.mark_rank = 1
          ORDER BY mv.season, mv.player_id
        ), top_tackles AS (
         SELECT DISTINCT ON (mv.season) mv.season,
            concat_ws(' '::text, mv.player_first_name, mv.player_last_name) AS top_tackles_player,
            mv.total_tackles AS top_tackles_total,
            mv.player_team AS top_tackles_team
           FROM mv_player_totals mv
          WHERE mv.tackle_rank = 1
          ORDER BY mv.season, mv.player_id
        )
 SELECT b.season,
    b.total_matches,
    b.avg_game_score,
    b.highest_score,
    b.biggest_margin,
    b.premiers,
    d.top_disposals_player,
    d.top_disposals_total,
    d.top_disposals_team,
    g.top_goals_player,
    g.top_goals_total,
    g.top_goals_team,
    k.top_kicks_player,
    k.top_kicks_total,
    k.top_kicks_team,
    h.top_handballs_player,
    h.top_handballs_total,
    h.top_handballs_team,
    m.top_marks_player,
    m.top_marks_total,
    m.top_marks_team,
    t.top_tackles_player,
    t.top_tackles_total,
    t.top_tackles_team
   FROM base b
     LEFT JOIN top_disposals d ON b.season = d.season
     LEFT JOIN top_goals g ON b.season = g.season
     LEFT JOIN top_kicks k ON b.season = k.season
     LEFT JOIN top_handballs h ON b.season = h.season
     LEFT JOIN top_marks m ON b.season = m.season
     LEFT JOIN top_tackles t ON b.season = t.season
  ORDER BY b.season DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| public     | mv_season_top_players      |  WITH player_totals AS (
         SELECT EXTRACT(year FROM afl_data.match_date)::integer AS season,
            afl_data.player_id,
            afl_data.player_first_name,
            afl_data.player_last_name,
            max(afl_data.player_team) AS player_team,
            sum(afl_data.disposals) AS total_disposals,
            sum(afl_data.goals) AS total_goals
           FROM afl_data
          WHERE afl_data.disposals::text ~ '^\d+$'::text OR afl_data.goals::text ~ '^\d+$'::text
          GROUP BY (EXTRACT(year FROM afl_data.match_date)::integer), afl_data.player_id, afl_data.player_first_name, afl_data.player_last_name
        ), ranked AS (
         SELECT player_totals.season,
            player_totals.player_id,
            player_totals.player_first_name,
            player_totals.player_last_name,
            player_totals.player_team,
            player_totals.total_disposals,
            player_totals.total_goals,
            rank() OVER (PARTITION BY player_totals.season ORDER BY player_totals.total_disposals DESC) AS disp_rank,
            rank() OVER (PARTITION BY player_totals.season ORDER BY player_totals.total_goals DESC) AS goal_rank
           FROM player_totals
        )
 SELECT season,
    player_id,
    player_first_name,
    player_last_name,
    player_team,
    total_disposals,
    total_goals,
    disp_rank,
    goal_rank
   FROM ranked
  WHERE disp_rank = 1 OR goal_rank = 1
  ORDER BY season DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| public     | mv_seasons                 |  SELECT EXTRACT(year FROM match_date)::integer AS season,
    count(*) AS total_matches
   FROM v_matches
  GROUP BY (EXTRACT(year FROM match_date)::integer)
  ORDER BY (EXTRACT(year FROM match_date)::integer) DESC;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| public     | mv_team_player_careers     |  WITH debut_info AS (
         SELECT afl_data.player_id,
            min(afl_data.match_date) AS debut_date
           FROM afl_data
          WHERE afl_data.player_team IS NOT NULL
          GROUP BY afl_data.player_id
        ), first_round_info AS (
         SELECT a_1.player_id,
            a_1.match_round::integer AS debut_round
           FROM afl_data a_1
             JOIN debut_info d_1 ON a_1.player_id = d_1.player_id AND a_1.match_date = d_1.debut_date
          WHERE a_1.player_team IS NOT NULL
         LIMIT 1
        )
 SELECT a.player_id,
    a.player_first_name,
    a.player_last_name,
    a.player_team,
    EXTRACT(year FROM d.debut_date) AS debut_year,
    f.debut_round,
    d.debut_date,
    count(DISTINCT a.match_id) AS games_played,
    sum(a.goals) AS career_goals,
    sum(a.behinds) AS career_behinds,
    sum(a.disposals) AS career_disposals,
    sum(a.kicks) AS career_kicks,
    sum(a.handballs) AS career_handballs,
    sum(a.marks) AS career_marks,
    sum(a.tackles) AS career_tackles,
    sum(a.hitouts) AS career_hitouts
   FROM afl_data a
     JOIN debut_info d ON a.player_id = d.player_id
     LEFT JOIN first_round_info f ON a.player_id = f.player_id
  WHERE a.player_team IS NOT NULL
  GROUP BY a.player_id, a.player_first_name, a.player_last_name, a.player_team, d.debut_date, f.debut_round;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public     | mv_team_seasons            |  SELECT t.team_name,
    min(EXTRACT(year FROM m.match_date)) AS first_season,
    max(EXTRACT(year FROM m.match_date)) AS last_season,
    count(*) AS total_matches
   FROM v_teams t
     JOIN v_matches m ON t.team_name = m.match_home_team OR t.team_name = m.match_away_team
  GROUP BY t.team_name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| public     | mv_team_winloss            |  WITH games AS (
         SELECT unnest(ARRAY[v_matches.match_home_team, v_matches.match_away_team]) AS team_name,
            v_matches.match_winner,
            GREATEST(v_matches.match_home_team_score, v_matches.match_away_team_score) AS team_score,
            abs(v_matches.match_margin) AS margin,
            v_matches.match_round = 'GF'::text AND v_matches.match_winner IS NOT NULL AS is_premiership
           FROM v_matches
        )
 SELECT team_name,
    count(*) AS total_matches,
    count(*) FILTER (WHERE is_premiership AND match_winner = team_name) AS premierships,
    max(team_score) AS highest_score,
    max(margin) AS biggest_win,
    round(100.0 * count(*) FILTER (WHERE match_winner = team_name)::numeric / NULLIF(count(*), 0)::numeric, 1) AS win_rate_pct
   FROM games
  GROUP BY team_name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| public     | mv_xr_bundles              |  WITH z AS (
         SELECT f.id,
            f.match_id,
            f.match_date,
            f.player_id,
            f.player_first_name,
            f.player_last_name,
            f.player_team,
            f.player_position,
            f.tog_pct,
            f.fge,
            f.season,
            f.goals,
            f.behinds,
            f.goal_assists,
            f.score_involvements,
            f.shots_at_goal,
            f.kicks,
            f.handballs,
            f.effective_disposals,
            f.disposals,
            f.metres_gained,
            f.score_launches,
            f.inside_fifties,
            f.rebounds,
            f.contested_possessions,
            f.ground_ball_gets,
            f.centre_clearances,
            f.stoppage_clearances,
            f.clearances,
            f.f50_ground_ball_gets,
            f.marks,
            f.contested_marks,
            f.intercept_marks,
            f.intercepts,
            f.marks_inside_fifty,
            f.marks_on_lead,
            f.spoils,
            f.tackles,
            f.tackles_inside_fifty,
            f.pressure_acts,
            f.one_percenters,
            f.hitouts,
            f.hta,
            f.hwp,
            f.ruck_contests,
            f.clangers,
            f.turnovers,
            f.fka,
            f.fkf,
            f.goals_fge,
            f.behinds_fge,
            f.goal_assists_fge,
            f.score_involvements_fge,
            f.shots_at_goal_fge,
            f.kicks_fge,
            f.handballs_fge,
            f.effective_disposals_fge,
            f.ineffective_disposals_fge,
            f.metres_gained_fge,
            f.score_launches_fge,
            f.inside_fifties_fge,
            f.rebounds_fge,
            f.contested_possessions_fge,
            f.ground_ball_gets_fge,
            f.centre_clearances_fge,
            f.stoppage_clearances_fge,
            f.clearances_fge,
            f.f50_ground_ball_gets_fge,
            f.marks_fge,
            f.contested_marks_fge,
            f.intercept_marks_fge,
            f.intercepts_fge,
            f.marks_inside_fifty_fge,
            f.marks_on_lead_fge,
            f.spoils_fge,
            f.tackles_fge,
            f.tackles_inside_fifty_fge,
            f.pressure_acts_fge,
            f.one_percenters_fge,
            f.hitouts_fge,
            f.hta_fge,
            f.ruck_contests_fge,
            f.ruc_gate,
            f.clangers_fge,
            f.turnovers_fge,
            f.fka_fge,
            f.fkf_fge,
            clamp(((f.goals_fge - s.mu_goals) / NULLIF(s.sd_goals, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_goals,
            clamp(((f.behinds_fge - s.mu_behinds) / NULLIF(s.sd_behinds, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_behinds,
            clamp(((f.goal_assists_fge - s.mu_goal_assists) / NULLIF(s.sd_goal_assists, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_goal_assists,
            clamp(((f.score_involvements_fge - s.mu_score_involvements) / NULLIF(s.sd_score_involvements, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_score_involvements,
            clamp(((f.shots_at_goal_fge - s.mu_shots) / NULLIF(s.sd_shots, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_shots,
            clamp(((f.kicks_fge - s.mu_kicks) / NULLIF(s.sd_kicks, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_kicks,
            clamp(((f.metres_gained_fge - s.mu_metres_gained) / NULLIF(s.sd_metres_gained, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_metres_gained,
            clamp(((f.score_launches_fge - s.mu_score_launches) / NULLIF(s.sd_score_launches, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_score_launches,
            clamp(((f.inside_fifties_fge - s.mu_inside_fifties) / NULLIF(s.sd_inside_fifties, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_inside_fifties,
            clamp(((f.rebounds_fge - s.mu_rebounds) / NULLIF(s.sd_rebounds, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_rebounds,
            clamp(((f.effective_disposals_fge - s.mu_eff_disp) / NULLIF(s.sd_eff_disp, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_effective_disposals,
            clamp(((f.ineffective_disposals_fge - s.mu_ineff_disp) / NULLIF(s.sd_ineff_disp, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_ineffective_disposals,
            clamp(((f.contested_possessions_fge - s.mu_cp) / NULLIF(s.sd_cp, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_contested_possessions,
            clamp(((f.ground_ball_gets_fge - s.mu_gbg) / NULLIF(s.sd_gbg, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_ground_ball_gets,
            clamp(((f.centre_clearances_fge - s.mu_ccl) / NULLIF(s.sd_ccl, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_centre_clearances,
            clamp(((f.stoppage_clearances_fge - s.mu_scl) / NULLIF(s.sd_scl, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_stoppage_clearances,
            clamp(((f.clearances_fge - s.mu_clr) / NULLIF(s.sd_clr, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_clearances,
            clamp(((f.f50_ground_ball_gets_fge - s.mu_f50_gbg) / NULLIF(s.sd_f50_gbg, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_f50_gbg,
            clamp(((f.marks_fge - s.mu_marks) / NULLIF(s.sd_marks, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_marks,
            clamp(((f.contested_marks_fge - s.mu_cmarks) / NULLIF(s.sd_cmarks, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_contested_marks,
            clamp(((f.intercept_marks_fge - s.mu_imarks) / NULLIF(s.sd_imarks, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_intercept_marks,
            clamp(((f.intercepts_fge - s.mu_intercepts) / NULLIF(s.sd_intercepts, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_intercepts,
            clamp(((f.marks_inside_fifty_fge - s.mu_marks_i50) / NULLIF(s.sd_marks_i50, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_marks_i50,
            clamp(((f.marks_on_lead_fge - s.mu_marks_on_lead) / NULLIF(s.sd_marks_on_lead, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_marks_on_lead,
            clamp(((f.spoils_fge - s.mu_spoils) / NULLIF(s.sd_spoils, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_spoils,
            clamp(((f.tackles_fge - s.mu_tackles) / NULLIF(s.sd_tackles, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_tackles,
            clamp(((f.tackles_inside_fifty_fge - s.mu_ti50) / NULLIF(s.sd_ti50, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_tackles_i50,
            clamp(((f.pressure_acts_fge - s.mu_pressure) / NULLIF(s.sd_pressure, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_pressure_acts,
            clamp(((f.one_percenters_fge - s.mu_onepers) / NULLIF(s.sd_onepers, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_one_percenters,
            clamp(((f.hta_fge - s.mu_hta) / NULLIF(s.sd_hta, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_hta,
            clamp((f.hwp - s.mu_hwp) / NULLIF(s.sd_hwp, 0::double precision), '-2.5'::numeric::double precision, 2.5::double precision) AS z_hwp,
            clamp(((f.ruck_contests_fge - s.mu_ruck_contests) / NULLIF(s.sd_ruck_contests, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_ruck_contests,
            clamp(((f.clangers_fge - s.mu_clangers) / NULLIF(s.sd_clangers, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_clangers,
            clamp(((f.turnovers_fge - s.mu_turnovers) / NULLIF(s.sd_turnovers, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_turnovers,
            clamp(((f.fka_fge - s.mu_fka) / NULLIF(s.sd_fka, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_fka,
            clamp(((f.fkf_fge - s.mu_fkf) / NULLIF(s.sd_fkf, 0::numeric))::double precision, '-2.5'::numeric::double precision, 2.5::double precision) AS z_fkf
           FROM mv_xr_features f
             JOIN mv_xr_stats s USING (season, player_position)
        )
 SELECT id,
    match_id,
    match_date,
    player_id,
    player_first_name,
    player_last_name,
    player_team,
    player_position,
    tog_pct,
    fge,
    season,
    goals,
    behinds,
    goal_assists,
    score_involvements,
    shots_at_goal,
    kicks,
    handballs,
    effective_disposals,
    disposals,
    metres_gained,
    score_launches,
    inside_fifties,
    rebounds,
    contested_possessions,
    ground_ball_gets,
    centre_clearances,
    stoppage_clearances,
    clearances,
    f50_ground_ball_gets,
    marks,
    contested_marks,
    intercept_marks,
    intercepts,
    marks_inside_fifty,
    marks_on_lead,
    spoils,
    tackles,
    tackles_inside_fifty,
    pressure_acts,
    one_percenters,
    hitouts,
    hta,
    hwp,
    ruck_contests,
    clangers,
    turnovers,
    fka,
    fkf,
    goals_fge,
    behinds_fge,
    goal_assists_fge,
    score_involvements_fge,
    shots_at_goal_fge,
    kicks_fge,
    handballs_fge,
    effective_disposals_fge,
    ineffective_disposals_fge,
    metres_gained_fge,
    score_launches_fge,
    inside_fifties_fge,
    rebounds_fge,
    contested_possessions_fge,
    ground_ball_gets_fge,
    centre_clearances_fge,
    stoppage_clearances_fge,
    clearances_fge,
    f50_ground_ball_gets_fge,
    marks_fge,
    contested_marks_fge,
    intercept_marks_fge,
    intercepts_fge,
    marks_inside_fifty_fge,
    marks_on_lead_fge,
    spoils_fge,
    tackles_fge,
    tackles_inside_fifty_fge,
    pressure_acts_fge,
    one_percenters_fge,
    hitouts_fge,
    hta_fge,
    ruck_contests_fge,
    ruc_gate,
    clangers_fge,
    turnovers_fge,
    fka_fge,
    fkf_fge,
    z_goals,
    z_behinds,
    z_goal_assists,
    z_score_involvements,
    z_shots,
    z_kicks,
    z_metres_gained,
    z_score_launches,
    z_inside_fifties,
    z_rebounds,
    z_effective_disposals,
    z_ineffective_disposals,
    z_contested_possessions,
    z_ground_ball_gets,
    z_centre_clearances,
    z_stoppage_clearances,
    z_clearances,
    z_f50_gbg,
    z_marks,
    z_contested_marks,
    z_intercept_marks,
    z_intercepts,
    z_marks_i50,
    z_marks_on_lead,
    z_spoils,
    z_tackles,
    z_tackles_i50,
    z_pressure_acts,
    z_one_percenters,
    z_hta,
    z_hwp,
    z_ruck_contests,
    z_clangers,
    z_turnovers,
    z_fka,
    z_fkf,
    1.4::double precision * z_goals + 0.2::double precision * z_behinds + 0.8::double precision * z_goal_assists + 0.6::double precision * z_score_involvements + 0.3::double precision * z_shots AS si,
    0.6::double precision * z_kicks + 0.8::double precision * z_metres_gained + 0.6::double precision * z_score_launches + 0.5::double precision * z_inside_fifties + 0.5::double precision * z_rebounds + 0.4::double precision * z_effective_disposals - 0.5::double precision * z_ineffective_disposals AS but,
    0.7::double precision * z_contested_possessions + 0.6::double precision * z_ground_ball_gets + 0.7::double precision * z_centre_clearances + 0.4::double precision * z_stoppage_clearances + 0.5::double precision * z_clearances + 0.6::double precision * z_f50_gbg AS win,
    0.3::double precision * z_marks + 0.9::double precision * z_contested_marks + 0.8::double precision * z_intercept_marks + 0.6::double precision * z_intercepts + 0.6::double precision * z_marks_i50 + 0.6::double precision * z_marks_on_lead + 0.6::double precision * z_spoils AS air,
    0.8::double precision * z_tackles + 0.9::double precision * z_tackles_i50 + 0.4::double precision * z_pressure_acts + 0.3::double precision * z_one_percenters AS pad,
    ruc_gate::double precision * (1.2::double precision * z_hta + 1.0::double precision * z_hwp + 0.4::double precision * z_ruck_contests) AS ruc,
    '-1.0'::numeric::double precision * z_clangers - 0.8::double precision * z_turnovers - 0.4::double precision * z_fka + 0.2::double precision * z_fkf AS dis,
    0.22::double precision * (1.4::double precision * z_goals + 0.2::double precision * z_behinds + 0.8::double precision * z_goal_assists + 0.6::double precision * z_score_involvements + 0.3::double precision * z_shots) + 0.16::double precision * (0.6::double precision * z_kicks + 0.8::double precision * z_metres_gained + 0.6::double precision * z_score_launches + 0.5::double precision * z_inside_fifties + 0.5::double precision * z_rebounds + 0.4::double precision * z_effective_disposals - 0.5::double precision * z_ineffective_disposals) + 0.16::double precision * (0.7::double precision * z_contested_possessions + 0.6::double precision * z_ground_ball_gets + 0.7::double precision * z_centre_clearances + 0.4::double precision * z_stoppage_clearances + 0.5::double precision * z_clearances + 0.6::double precision * z_f50_gbg) + 0.12::double precision * (0.3::double precision * z_marks + 0.9::double precision * z_contested_marks + 0.8::double precision * z_intercept_marks + 0.6::double precision * z_intercepts + 0.6::double precision * z_marks_i50 + 0.6::double precision * z_marks_on_lead + 0.6::double precision * z_spoils) + 0.16::double precision * (0.8::double precision * z_tackles + 0.9::double precision * z_tackles_i50 + 0.4::double precision * z_pressure_acts + 0.3::double precision * z_one_percenters) + 0.10::double precision * (ruc_gate::double precision * (1.2::double precision * z_hta + 1.0::double precision * z_hwp + 0.4::double precision * z_ruck_contests)) + 0.08::double precision * ('-1.0'::numeric::double precision * z_clangers - 0.8::double precision * z_turnovers - 0.4::double precision * z_fka + 0.2::double precision * z_fkf) AS xr_raw
   FROM z; |
| public     | mv_xr_features             |  SELECT id,
    match_id,
    match_date,
    player_id,
    player_first_name,
    player_last_name,
    player_team,
    player_position,
    tog_pct,
    fge,
    season,
    goals,
    behinds,
    goal_assists,
    score_involvements,
    shots_at_goal,
    kicks,
    handballs,
    effective_disposals,
    disposals,
    metres_gained,
    score_launches,
    inside_fifties,
    rebounds,
    contested_possessions,
    ground_ball_gets,
    centre_clearances,
    stoppage_clearances,
    clearances,
    f50_ground_ball_gets,
    marks,
    contested_marks,
    intercept_marks,
    intercepts,
    marks_inside_fifty,
    marks_on_lead,
    spoils,
    tackles,
    tackles_inside_fifty,
    pressure_acts,
    one_percenters,
    hitouts,
    hta,
    hwp,
    ruck_contests,
    clangers,
    turnovers,
    fka,
    fkf,
    goals_fge,
    behinds_fge,
    goal_assists_fge,
    score_involvements_fge,
    shots_at_goal_fge,
    kicks_fge,
    handballs_fge,
    effective_disposals_fge,
    ineffective_disposals_fge,
    metres_gained_fge,
    score_launches_fge,
    inside_fifties_fge,
    rebounds_fge,
    contested_possessions_fge,
    ground_ball_gets_fge,
    centre_clearances_fge,
    stoppage_clearances_fge,
    clearances_fge,
    f50_ground_ball_gets_fge,
    marks_fge,
    contested_marks_fge,
    intercept_marks_fge,
    intercepts_fge,
    marks_inside_fifty_fge,
    marks_on_lead_fge,
    spoils_fge,
    tackles_fge,
    tackles_inside_fifty_fge,
    pressure_acts_fge,
    one_percenters_fge,
    hitouts_fge,
    hta_fge,
    ruck_contests_fge,
    ruc_gate,
    clangers_fge,
    turnovers_fge,
    fka_fge,
    fkf_fge
   FROM v_xr_features;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public     | mv_xr_stats                |  SELECT season,
    player_position,
    avg(goals_fge) AS mu_goals,
    stddev_pop(goals_fge) AS sd_goals,
    avg(behinds_fge) AS mu_behinds,
    stddev_pop(behinds_fge) AS sd_behinds,
    avg(goal_assists_fge) AS mu_goal_assists,
    stddev_pop(goal_assists_fge) AS sd_goal_assists,
    avg(score_involvements_fge) AS mu_score_involvements,
    stddev_pop(score_involvements_fge) AS sd_score_involvements,
    avg(shots_at_goal_fge) AS mu_shots,
    stddev_pop(shots_at_goal_fge) AS sd_shots,
    avg(kicks_fge) AS mu_kicks,
    stddev_pop(kicks_fge) AS sd_kicks,
    avg(metres_gained_fge) AS mu_metres_gained,
    stddev_pop(metres_gained_fge) AS sd_metres_gained,
    avg(score_launches_fge) AS mu_score_launches,
    stddev_pop(score_launches_fge) AS sd_score_launches,
    avg(inside_fifties_fge) AS mu_inside_fifties,
    stddev_pop(inside_fifties_fge) AS sd_inside_fifties,
    avg(rebounds_fge) AS mu_rebounds,
    stddev_pop(rebounds_fge) AS sd_rebounds,
    avg(effective_disposals_fge) AS mu_eff_disp,
    stddev_pop(effective_disposals_fge) AS sd_eff_disp,
    avg(ineffective_disposals_fge) AS mu_ineff_disp,
    stddev_pop(ineffective_disposals_fge) AS sd_ineff_disp,
    avg(contested_possessions_fge) AS mu_cp,
    stddev_pop(contested_possessions_fge) AS sd_cp,
    avg(ground_ball_gets_fge) AS mu_gbg,
    stddev_pop(ground_ball_gets_fge) AS sd_gbg,
    avg(centre_clearances_fge) AS mu_ccl,
    stddev_pop(centre_clearances_fge) AS sd_ccl,
    avg(stoppage_clearances_fge) AS mu_scl,
    stddev_pop(stoppage_clearances_fge) AS sd_scl,
    avg(clearances_fge) AS mu_clr,
    stddev_pop(clearances_fge) AS sd_clr,
    avg(f50_ground_ball_gets_fge) AS mu_f50_gbg,
    stddev_pop(f50_ground_ball_gets_fge) AS sd_f50_gbg,
    avg(marks_fge) AS mu_marks,
    stddev_pop(marks_fge) AS sd_marks,
    avg(contested_marks_fge) AS mu_cmarks,
    stddev_pop(contested_marks_fge) AS sd_cmarks,
    avg(intercept_marks_fge) AS mu_imarks,
    stddev_pop(intercept_marks_fge) AS sd_imarks,
    avg(intercepts_fge) AS mu_intercepts,
    stddev_pop(intercepts_fge) AS sd_intercepts,
    avg(marks_inside_fifty_fge) AS mu_marks_i50,
    stddev_pop(marks_inside_fifty_fge) AS sd_marks_i50,
    avg(marks_on_lead_fge) AS mu_marks_on_lead,
    stddev_pop(marks_on_lead_fge) AS sd_marks_on_lead,
    avg(spoils_fge) AS mu_spoils,
    stddev_pop(spoils_fge) AS sd_spoils,
    avg(tackles_fge) AS mu_tackles,
    stddev_pop(tackles_fge) AS sd_tackles,
    avg(tackles_inside_fifty_fge) AS mu_ti50,
    stddev_pop(tackles_inside_fifty_fge) AS sd_ti50,
    avg(pressure_acts_fge) AS mu_pressure,
    stddev_pop(pressure_acts_fge) AS sd_pressure,
    avg(one_percenters_fge) AS mu_onepers,
    stddev_pop(one_percenters_fge) AS sd_onepers,
    avg(hta_fge) AS mu_hta,
    stddev_pop(hta_fge) AS sd_hta,
    avg(hwp) AS mu_hwp,
    stddev_pop(hwp) AS sd_hwp,
    avg(ruck_contests_fge) AS mu_ruck_contests,
    stddev_pop(ruck_contests_fge) AS sd_ruck_contests,
    avg(clangers_fge) AS mu_clangers,
    stddev_pop(clangers_fge) AS sd_clangers,
    avg(turnovers_fge) AS mu_turnovers,
    stddev_pop(turnovers_fge) AS sd_turnovers,
    avg(fka_fge) AS mu_fka,
    stddev_pop(fka_fge) AS sd_fka,
    avg(fkf_fge) AS mu_fkf,
    stddev_pop(fkf_fge) AS sd_fkf
   FROM mv_xr_features
  GROUP BY season, player_position;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| public     | mv_xrating                 |  WITH base AS (
         SELECT mv_xr_bundles.id,
            mv_xr_bundles.match_id,
            mv_xr_bundles.match_date,
            mv_xr_bundles.season,
            mv_xr_bundles.player_id,
            mv_xr_bundles.player_first_name,
            mv_xr_bundles.player_last_name,
            mv_xr_bundles.player_team,
            mv_xr_bundles.player_position,
            mv_xr_bundles.tog_pct,
            mv_xr_bundles.si,
            mv_xr_bundles.but,
            mv_xr_bundles.win,
            mv_xr_bundles.air,
            mv_xr_bundles.pad,
            mv_xr_bundles.ruc,
            mv_xr_bundles.dis,
            mv_xr_bundles.xr_raw,
            (mv_xr_bundles.xr_raw - avg(mv_xr_bundles.xr_raw) OVER (PARTITION BY mv_xr_bundles.season)) / NULLIF(stddev_pop(mv_xr_bundles.xr_raw) OVER (PARTITION BY mv_xr_bundles.season), 0::double precision) AS xr_z
           FROM mv_xr_bundles
        ), rep AS (
         SELECT mv_xr_bundles.season,
            mv_xr_bundles.player_position,
            percentile_disc(0.20::double precision) WITHIN GROUP (ORDER BY mv_xr_bundles.xr_raw) AS xr_rep
           FROM mv_xr_bundles
          GROUP BY mv_xr_bundles.season, mv_xr_bundles.player_position
        ), plus AS (
         SELECT b.id,
            b.match_id,
            b.match_date,
            b.season,
            b.player_id,
            b.player_first_name,
            b.player_last_name,
            b.player_team,
            b.player_position,
            b.tog_pct,
            b.si,
            b.but,
            b.win,
            b.air,
            b.pad,
            b.ruc,
            b.dis,
            b.xr_raw,
            b.xr_z,
            b.xr_raw - r.xr_rep AS xr_plus_raw,
            (b.xr_raw - r.xr_rep - avg(b.xr_raw - r.xr_rep) OVER (PARTITION BY b.season)) / NULLIF(stddev_pop(b.xr_raw - r.xr_rep) OVER (PARTITION BY b.season), 0::double precision) AS xr_plus_z
           FROM base b
             JOIN rep r USING (season, player_position)
        )
 SELECT id,
    match_id,
    match_date,
    season,
    player_id,
    player_first_name,
    player_last_name,
    player_team,
    player_position,
    tog_pct,
    si,
    but,
    win,
    air,
    pad,
    ruc,
    dis,
    xr_raw,
    xr_z,
    xr_plus_raw,
    xr_plus_z,
    50.0::double precision + 10.0::double precision * COALESCE(xr_z, 0::double precision) AS xr,
    50.0::double precision + 10.0::double precision * COALESCE(xr_plus_z, 0::double precision) AS xr_plus
   FROM plus p;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| public     | player_team_1986           |  SELECT player_id,
    player_first_name,
    player_last_name,
    max(player_team) AS prior_team
   FROM afl_data
  WHERE EXTRACT(year FROM match_date) = 1986::numeric
  GROUP BY player_id, player_first_name, player_last_name;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| public     | v_team_player_totals       |  SELECT player_team AS team_name,
    player_id,
    concat_ws(' '::text, player_first_name, player_last_name) AS full_name,
    count(*) AS games_played,
    COALESCE(sum(disposals), 0::bigint)::integer AS total_disposals,
    round(COALESCE(sum(disposals), 0::bigint)::numeric / count(*)::numeric, 1) AS disp_per_game,
    COALESCE(sum(goals), 0::bigint)::integer AS total_goals,
    round(COALESCE(sum(goals), 0::bigint)::numeric / count(*)::numeric, 1) AS goals_per_game
   FROM afl_data
  GROUP BY player_team, player_id, (concat_ws(' '::text, player_first_name, player_last_name));                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |